<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Standard HTML5 doctype and language declaration -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <!-- Page title describing this tutorial -->
        <title>Adapted Tutorial - Loading External GeoJSON Data</title>

        <!-- External stylesheet links -->
        <!-- Custom CSS styles for the map application -->
        <link rel="stylesheet" href="css/style.css">
        <!-- Leaflet CSS for map styling, controls, and default appearance -->
        <link rel="stylesheet" href="lib/leaflet/dist/leaflet.css">
        
        <!--[if IE<9]>
            <!-- Fallback CSS for older Internet Explorer versions (IE 8 and below) -->
            <link rel="stylesheet" href="css/style.ie.css">
        <![endif]-->

        <!-- Internal styles for this specific tutorial page -->
        <style>
            /* Reset and base styles */
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f5f5f5;
            }
            
            /* Tutorial information section - clean and minimal */
            .tutorial-info {
                max-width: 800px;
                margin: 20px auto;
                padding: 30px;
                background-color: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            /* Simple title styling */
            .tutorial-info h1 {
                font-size: 1.8em;
                color: #333;
                margin: 0 0 10px 0;
            }
            
            /* Subtitle or description */
            .tutorial-info p {
                color: #666;
                line-height: 1.6;
                margin-bottom: 15px;
            }
            
            /* List styling */
            .tutorial-info ul {
                margin: 15px 0;
                padding-left: 20px;
            }
            
            .tutorial-info li {
                margin-bottom: 8px;
                color: #666;
            }
            
            /* Map container takes up most of the viewport */
            #mapid {
                height: 70vh;
                width: 100%;
                max-width: 1200px;
                margin: 20px auto;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            /* Code display section styling */
            .code-section {
                max-width: 1200px;
                margin: 40px auto 20px auto;
                padding: 30px;
                background-color: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            
            .code-section h2 {
                font-size: 1.5em;
                color: #333;
                margin: 0 0 20px 0;
            }
            
            /* Code block container */
            .code-block {
                background-color: #f8f8f8;
                border: 1px solid #ddd;
                border-radius: 4px;
                padding: 20px;
                overflow-x: auto;
                font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
                font-size: 14px;
                line-height: 1.5;
            }
            
            /* Syntax highlighting for JavaScript */
            .code-block .comment {
                color: #6a9955;
                font-style: italic;
            }
            
            .code-block .keyword {
                color: #0000ff;
                font-weight: bold;
            }
            
            .code-block .string {
                color: #a31515;
            }
            
            .code-block .number {
                color: #098658;
            }
            
            .code-block .function {
                color: #795e26;
            }
            
            .code-block .property {
                color: #001080;
            }
        </style>
    </head>

    <body>
        <!-- Tutorial information section explaining what this demo shows -->
        <div class="tutorial-info">
            <h1>Adapted Tutorial - External GeoJSON Data Loading</h1>
            <p><strong>What this tutorial demonstrates:</strong></p>
            <ul>
                <li><strong>External Data Loading:</strong> Fetches GeoJSON data from an external file (MegaCities.geojson)</li>
                <li><strong>Fetch API:</strong> Uses modern JavaScript fetch() to load data asynchronously</li>
                <li><strong>Global Map Variable:</strong> Shows proper map variable scoping and initialization</li>
                <li><strong>Function-based Architecture:</strong> Demonstrates modular code organization</li>
                <li><strong>Dynamic Popups:</strong> Creates popups that display all feature properties automatically</li>
                <li><strong>Custom Markers:</strong> Uses circle markers instead of default pin markers</li>
                <li><strong>Event Listeners:</strong> Waits for DOM to load before initializing the map</li>
                <li><strong>World View:</strong> Centers on a global view to show international data</li>
            </ul>
            
            <p><strong>Data Source:</strong> This tutorial loads data about world megacities from <code>data/MegaCities.geojson</code>.
            Each city will appear as a black circle marker with white border. Click on any marker to see detailed information about that city.</p>
            
            <p><strong>Technical Implementation:</strong></p>
            <ul>
                <li><code>createMap()</code> function sets up the world view</li>
                <li><code>getData()</code> function uses fetch API to load GeoJSON</li>
                <li><code>onEachFeature()</code> creates dynamic popups for each city</li>
                <li>Custom <code>geojsonMarkerOptions</code> for consistent appearance</li>
            </ul>
        </div>
        
        <!-- Main container for the interactive Leaflet map -->
        <!-- The 'mapid' is referenced in the adaptedTutorial.js to initialize the map -->
        <!-- This tutorial creates a global view centered at [20, 0] with zoom level 2 -->
        <div id="mapid"></div>
        
        <!-- Code display section showing the JavaScript used in this tutorial -->
        <div class="code-section">
            <h2>JavaScript Code (adaptedTutorial.js)</h2>
            <div class="code-block"><span class="comment">/* Map of GeoJSON data from time_series.geojson */</span>
<span class="comment">// Declare global map variable.</span>
<span class="keyword">var</span> map;

<span class="comment">// Create createMap function.</span>
<span class="keyword">function</span> <span class="function">createMap</span>(){
    <span class="comment">// Configure the map.</span>
    map = L.<span class="function">map</span>(<span class="string">'mapid'</span>, {
        <span class="property">center</span>: [<span class="number">20</span>, <span class="number">0</span>],
        <span class="property">zoom</span>: <span class="number">2</span>
    });
    
    <span class="comment">// Load OSM base tilelayer to map.</span>
    L.<span class="function">tileLayer</span>(<span class="string">'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'</span>, {
        <span class="property">attribution</span>: <span class="string">'&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap contributors&lt;/a&gt;'</span>
    }).<span class="function">addTo</span>(map);

    <span class="comment">// Call getData function to load data to map.</span>
    <span class="function">getData</span>(map);
};

<span class="comment">// Create onEachFeature function.</span>
<span class="keyword">function</span> <span class="function">onEachFeature</span>(feature, layer) {
    <span class="comment">// Create popupContent variable to hold html string.</span>
    <span class="keyword">var</span> popupContent = <span class="string">""</span>;
    <span class="keyword">if</span> (feature.<span class="property">properties</span>) {
        <span class="comment">// Use loop to load feature property names and values to popupContent.</span>
        <span class="keyword">for</span> (<span class="keyword">var</span> property <span class="keyword">in</span> feature.<span class="property">properties</span>){
            popupContent += <span class="string">"&lt;p&gt;"</span> + property + <span class="string">": "</span> + feature.<span class="property">properties</span>[property] + <span class="string">"&lt;/p&gt;"</span>;
        }
        layer.<span class="function">bindPopup</span>(popupContent);
    };
};

<span class="comment">// Get data from data file, convert it to point features, and load to map.</span>
<span class="keyword">function</span> <span class="function">getData</span>(map){
    <span class="comment">// Get data from geojson file.</span>
    <span class="function">fetch</span>(<span class="string">"data/MegaCities.geojson"</span>)
        .<span class="function">then</span>(<span class="keyword">function</span>(response){
            <span class="keyword">return</span> response.<span class="function">json</span>();
        })
        .<span class="function">then</span>(<span class="keyword">function</span>(json){
            <span class="keyword">var</span> geojsonMarkerOptions = {
                <span class="property">radius</span>: <span class="number">5</span>,
                <span class="property">fillColor</span>: <span class="string">"#000000"</span>,
                <span class="property">color</span>: <span class="string">"#ffffff"</span>,
            };

            <span class="comment">// Create a Leaflet GeoJSON layer and add it to the map.</span>
            L.<span class="function">geoJson</span>(json, {
                <span class="property">pointToLayer</span>: <span class="keyword">function</span>(feature, latlng) {
                    <span class="keyword">return</span> L.<span class="function">circleMarker</span>(latlng, geojsonMarkerOptions);
                }
            }).<span class="function">addTo</span>(map);

            <span class="comment">// Add popup functionality to each feature.</span>
            L.<span class="function">geoJson</span>(json, { <span class="property">onEachFeature</span> : onEachFeature
            }).<span class="function">addTo</span>(map);
        })
};

<span class="comment">// Add event listener.</span>
document.<span class="function">addEventListener</span>(<span class="string">'DOMContentLoaded'</span>, createMap)</div>
        </div>
        
        <!-- External JavaScript libraries and scripts -->
        <!-- Leaflet JavaScript library - the core mapping functionality -->
        <script type="text/javascript" src="lib/leaflet/dist/leaflet-src.js"></script>
        
        <!-- Tutorial script that demonstrates loading external GeoJSON data -->
        <!-- This script contains: -->
        <!-- - createMap() function for map initialization -->
        <!-- - getData() function for fetching external GeoJSON files -->
        <!-- - onEachFeature() function for creating dynamic popups -->
        <!-- - Event listener for DOM content loaded -->
        <script type="text/javascript" src="js/adaptedTutorial.js"></script>
        
        <!-- Attribution note for any icons or resources used -->
        <!--Forward and Reverse icons created by scott desmond @ https://thenounproject.com/icon/arrow-forward-2352161/-->
    </body>
</html>
